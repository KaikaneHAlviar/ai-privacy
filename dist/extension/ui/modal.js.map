{
  "version": 3,
  "sources": ["../../../extension/ui/modal.ts"],
  "sourcesContent": ["// extension/ui/modal.ts\r\n// WARNING-ONLY version: no redaction, no text insertion\r\n\r\nexport type ModalChoice = \"continue\";\r\nexport type ModalRiskLevel = \"ALLOW\" | \"WARN\" | \"BLOCK\";\r\n\r\nexport interface WarningModalArgs {\r\n  riskLevel: ModalRiskLevel;\r\n  riskScore: number; // 0..1\r\n  explanation: string[];\r\n}\r\n\r\nconst OVERLAY_ID = \"__ai_privacy_guard_overlay__\";\r\nconst STYLE_ID = \"__ai_privacy_guard_style__\";\r\n\r\nfunction ensureStyles() {\r\n  if (document.getElementById(STYLE_ID)) return;\r\n\r\n  const style = document.createElement(\"style\");\r\n  style.id = STYLE_ID;\r\n  style.textContent = `\r\n    #${OVERLAY_ID} {\r\n      position: fixed;\r\n      inset: 0;\r\n      z-index: 2147483647;\r\n      background: rgba(0,0,0,0.45);\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      padding: 16px;\r\n      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\r\n    }\r\n    #${OVERLAY_ID} .apg-modal {\r\n      width: min(560px, 100%);\r\n      background: #0b0d12;\r\n      color: #f5f7ff;\r\n      border: 1px solid rgba(255,255,255,0.12);\r\n      border-radius: 14px;\r\n      box-shadow: 0 12px 40px rgba(0,0,0,0.5);\r\n      overflow: hidden;\r\n    }\r\n    #${OVERLAY_ID} .apg-header {\r\n      padding: 16px 18px 10px 18px;\r\n      display: flex;\r\n      gap: 12px;\r\n      align-items: flex-start;\r\n    }\r\n    #${OVERLAY_ID} .apg-icon {\r\n      width: 34px;\r\n      height: 34px;\r\n      border-radius: 10px;\r\n      display: grid;\r\n      place-items: center;\r\n      background: rgba(255,255,255,0.08);\r\n      flex: 0 0 auto;\r\n      margin-top: 2px;\r\n    }\r\n    #${OVERLAY_ID} .apg-title {\r\n      font-size: 16px;\r\n      font-weight: 700;\r\n      line-height: 1.2;\r\n      margin: 0;\r\n    }\r\n    #${OVERLAY_ID} .apg-subtitle {\r\n      margin: 6px 0 0 0;\r\n      color: rgba(245,247,255,0.75);\r\n      font-size: 13px;\r\n      line-height: 1.35;\r\n    }\r\n    #${OVERLAY_ID} .apg-body {\r\n      padding: 0 18px 14px 18px;\r\n    }\r\n    #${OVERLAY_ID} .apg-pill {\r\n      display: inline-flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n      border: 1px solid rgba(255,255,255,0.14);\r\n      background: rgba(255,255,255,0.06);\r\n      border-radius: 999px;\r\n      padding: 6px 10px;\r\n      font-size: 12px;\r\n      color: rgba(245,247,255,0.85);\r\n      margin-top: 8px;\r\n    }\r\n    #${OVERLAY_ID} .apg-list {\r\n      margin: 12px 0 0 0;\r\n      padding: 0 0 0 18px;\r\n      color: rgba(245,247,255,0.85);\r\n      font-size: 13px;\r\n      line-height: 1.45;\r\n    }\r\n    #${OVERLAY_ID} .apg-footer {\r\n      padding: 14px 18px 18px 18px;\r\n      display: flex;\r\n      gap: 10px;\r\n      justify-content: flex-end;\r\n      border-top: 1px solid rgba(255,255,255,0.10);\r\n      background: rgba(255,255,255,0.03);\r\n      flex-wrap: wrap;\r\n    }\r\n    #${OVERLAY_ID} .apg-btn {\r\n      appearance: none;\r\n      border: 1px solid rgba(255,255,255,0.14);\r\n      background: rgba(255,255,255,0.06);\r\n      color: #f5f7ff;\r\n      padding: 10px 12px;\r\n      border-radius: 12px;\r\n      font-weight: 650;\r\n      font-size: 13px;\r\n      cursor: pointer;\r\n    }\r\n    #${OVERLAY_ID} .apg-btn:hover { background: rgba(255,255,255,0.10); }\r\n    #${OVERLAY_ID} .apg-btn:focus { outline: 2px solid rgba(124,92,255,0.75); outline-offset: 2px; }\r\n\r\n    #${OVERLAY_ID} .apg-btn-primary {\r\n      border-color: rgba(124,92,255,0.55);\r\n      background: rgba(124,92,255,0.25);\r\n    }\r\n    #${OVERLAY_ID} .apg-btn-primary:hover { background: rgba(124,92,255,0.35); }\r\n\r\n    #${OVERLAY_ID} .apg-btn-danger {\r\n      border-color: rgba(255,88,88,0.50);\r\n      background: rgba(255,88,88,0.18);\r\n    }\r\n    #${OVERLAY_ID} .apg-btn-danger:hover { background: rgba(255,88,88,0.28); }\r\n\r\n    #${OVERLAY_ID} .apg-kbd {\r\n      border: 1px solid rgba(255,255,255,0.14);\r\n      background: rgba(255,255,255,0.06);\r\n      border-bottom-color: rgba(255,255,255,0.22);\r\n      padding: 2px 6px;\r\n      border-radius: 8px;\r\n      font-size: 11px;\r\n      color: rgba(245,247,255,0.8);\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n}\r\n\r\nfunction formatPercent01(x: number): string {\r\n  const pct = Math.round(Math.max(0, Math.min(1, x)) * 100);\r\n  return `${pct}%`;\r\n}\r\n\r\nfunction iconForLevel(level: ModalRiskLevel): string {\r\n  if (level === \"BLOCK\") return \"\u26D4\";\r\n  return \"\u26A0\uFE0F\";\r\n}\r\n\r\nfunction titleForLevel(level: ModalRiskLevel): string {\r\n  if (level === \"BLOCK\") return \"Sensitive data likely detected\";\r\n  return \"Potential sensitive data detected\";\r\n}\r\n\r\nfunction subtitleForLevel(level: ModalRiskLevel): string {\r\n  if (level === \"BLOCK\") {\r\n    return \"This looks like high-risk content (e.g., private keys). Consider redacting before sending.\";\r\n  }\r\n  return \"Review what was detected before sending this to an AI tool.\";\r\n}\r\n\r\nfunction removeExistingOverlay() {\r\n  const existing = document.getElementById(OVERLAY_ID);\r\n  if (existing) existing.remove();\r\n}\r\n\r\nfunction getFocusable(container: HTMLElement): HTMLElement[] {\r\n  const selectors = [\r\n    \"button\",\r\n    \"[href]\",\r\n    \"input\",\r\n    \"select\",\r\n    \"textarea\",\r\n    \"[tabindex]:not([tabindex='-1'])\",\r\n  ];\r\n  return Array.from(container.querySelectorAll<HTMLElement>(selectors.join(\",\"))).filter(\r\n    (el) => !el.hasAttribute(\"disabled\") && el.tabIndex !== -1\r\n  );\r\n}\r\n\r\nexport function showWarningModal(args: WarningModalArgs): Promise<ModalChoice> {\r\n  ensureStyles();\r\n  removeExistingOverlay();\r\n\r\n  return new Promise<ModalChoice>((resolve) => {\r\n    const overlay = document.createElement(\"div\");\r\n    overlay.id = OVERLAY_ID;\r\n\r\n    // Clicking outside cancels (safer default)\r\n    overlay.addEventListener(\"mousedown\", (e) => {\r\n      if (e.target === overlay) {\r\n        cleanup(\"continue\");\r\n      }\r\n    });\r\n\r\n    const modal = document.createElement(\"div\");\r\n    modal.className = \"apg-modal\";\r\n    modal.setAttribute(\"role\", \"dialog\");\r\n    modal.setAttribute(\"aria-modal\", \"true\");\r\n    modal.setAttribute(\"aria-label\", titleForLevel(args.riskLevel));\r\n\r\n    const header = document.createElement(\"div\");\r\n    header.className = \"apg-header\";\r\n\r\n    const icon = document.createElement(\"div\");\r\n    icon.className = \"apg-icon\";\r\n    icon.textContent = iconForLevel(args.riskLevel);\r\n\r\n    const headerText = document.createElement(\"div\");\r\n\r\n    const title = document.createElement(\"p\");\r\n    title.className = \"apg-title\";\r\n    title.textContent = titleForLevel(args.riskLevel);\r\n\r\n    const subtitle = document.createElement(\"p\");\r\n    subtitle.className = \"apg-subtitle\";\r\n    subtitle.textContent = subtitleForLevel(args.riskLevel);\r\n\r\n    const pill = document.createElement(\"div\");\r\n    pill.className = \"apg-pill\";\r\n    pill.textContent = `Risk confidence: ${formatPercent01(args.riskScore)} \u2022 Press `;\r\n    const kbd = document.createElement(\"span\");\r\n    kbd.className = \"apg-kbd\";\r\n    kbd.textContent = \"Esc\";\r\n    pill.appendChild(kbd);\r\n    pill.appendChild(document.createTextNode(\" to cancel\"));\r\n\r\n    headerText.appendChild(title);\r\n    headerText.appendChild(subtitle);\r\n    headerText.appendChild(pill);\r\n\r\n    header.appendChild(icon);\r\n    header.appendChild(headerText);\r\n\r\n    const body = document.createElement(\"div\");\r\n    body.className = \"apg-body\";\r\n\r\n    const list = document.createElement(\"ul\");\r\n    list.className = \"apg-list\";\r\n\r\n    const explanation = args.explanation?.length ? args.explanation : [\"No details available.\"];\r\n    for (const line of explanation.slice(0, 6)) {\r\n      const li = document.createElement(\"li\");\r\n      li.textContent = line;\r\n      list.appendChild(li);\r\n    }\r\n    body.appendChild(list);\r\n\r\n    const footer = document.createElement(\"div\");\r\n    footer.className = \"apg-footer\";\r\n\r\n    const btnContinue = document.createElement(\"button\");\r\n    btnContinue.className = \"apg-btn apg-btn-primary\";\r\n    btnContinue.textContent = \"Got it\";\r\n    btnContinue.addEventListener(\"click\", () => cleanup(\"continue\"));\r\n\r\n    // Order: safest actions are more prominent but not confusing\r\n    footer.appendChild(btnContinue);\r\n\r\n    modal.appendChild(header);\r\n    modal.appendChild(body);\r\n    modal.appendChild(footer);\r\n    overlay.appendChild(modal);\r\n    document.body.appendChild(overlay);\r\n\r\n    // Focus management\r\n    const previouslyFocused = document.activeElement as HTMLElement | null;\r\n\r\n    const focusables = getFocusable(modal);\r\n    const initialFocus = btnContinue; // safest default\r\n    initialFocus.focus();\r\n\r\n    function onKeyDown(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") {\r\n        e.preventDefault();\r\n        cleanup(\"continue\");\r\n        return;\r\n      }\r\n\r\n      // Simple focus trap\r\n      if (e.key === \"Tab\") {\r\n        const items = getFocusable(modal);\r\n        if (items.length === 0) return;\r\n\r\n        const first = items[0];\r\n        const last = items[items.length - 1];\r\n        const active = document.activeElement as HTMLElement | null;\r\n\r\n        if (e.shiftKey && active === first) {\r\n          e.preventDefault();\r\n          last.focus();\r\n        } else if (!e.shiftKey && active === last) {\r\n          e.preventDefault();\r\n          first.focus();\r\n        }\r\n      }\r\n    }\r\n\r\n    document.addEventListener(\"keydown\", onKeyDown, true);\r\n\r\n    function cleanup(choice: ModalChoice) {\r\n      document.removeEventListener(\"keydown\", onKeyDown, true);\r\n      overlay.remove();\r\n      if (previouslyFocused && typeof previouslyFocused.focus === \"function\") {\r\n        previouslyFocused.focus();\r\n      }\r\n      resolve(choice);\r\n    }\r\n  });\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
