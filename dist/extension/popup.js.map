{
  "version": 3,
  "sources": ["../../extension/utils/constants.ts", "../../extension/ui/dashboard.ts", "../../extension/popup.ts"],
  "sourcesContent": ["/** Storage keys */\r\nexport const STORAGE_KEYS = {\r\n  ANALYTICS: \"apg_analytics\",\r\n} as const;\r\n\r\n/** Supported AI hosts for analytics labeling / display */\r\nexport const SUPPORTED_HOSTS = [\r\n  \"chat.openai.com\",\r\n  \"claude.ai\",\r\n  \"gemini.google.com\",\r\n  \"www.perplexity.ai\",\r\n] as const;\r\n\r\n/** UI limits */\r\nexport const UI_LIMITS = {\r\n  MAX_TOP_HOSTS: 8,\r\n  MAX_TOP_CATEGORIES: 10,\r\n  MAX_DAILY_POINTS: 14, // last N days\r\n} as const;\r\n\r\n/** File download metadata */\r\nexport const EXPORT = {\r\n  FILENAME_PREFIX: \"apg-analytics\",\r\n} as const;\r\n", "// extension/ui/dashboard.ts\r\n\r\nimport { EXPORT, STORAGE_KEYS, UI_LIMITS } from \"../utils/constants\";\r\n\r\ntype ModalChoice = \"redact\" | \"continue\" | \"cancel\";\r\ntype PromptEventSource = \"paste\" | \"send\";\r\ntype WarnLevel = \"WARN\" | \"BLOCK\";\r\n\r\ntype AnalyticsStoreV1 = {\r\n  version: 1;\r\n  warningsTotal: number;\r\n\r\n  byHost: Record<string, number>;\r\n  byCategory: Record<string, number>;\r\n  byAction: Record<ModalChoice, number>;\r\n  bySource: Record<PromptEventSource, number>;\r\n  byRiskLevel: Record<WarnLevel, number>;\r\n\r\n  daily: Record<string, number>; // YYYY-MM-DD -> count\r\n};\r\n\r\nfunction el<K extends keyof HTMLElementTagNameMap>(\r\n  tag: K,\r\n  attrs: Record<string, string> = {},\r\n  children: Array<HTMLElement | Text> = []\r\n): HTMLElementTagNameMap[K] {\r\n  const node = document.createElement(tag);\r\n  for (const [k, v] of Object.entries(attrs)) node.setAttribute(k, v);\r\n  for (const c of children) node.appendChild(c);\r\n  return node;\r\n}\r\n\r\nfunction text(t: string) {\r\n  return document.createTextNode(t);\r\n}\r\n\r\nfunction sortEntries(obj: Record<string, number>) {\r\n  return Object.entries(obj).sort((a, b) => b[1] - a[1]);\r\n}\r\n\r\nfunction formatDateKey(d: Date): string {\r\n  const yyyy = d.getFullYear();\r\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\r\n  const dd = String(d.getDate()).padStart(2, \"0\");\r\n  return `${yyyy}-${mm}-${dd}`;\r\n}\r\n\r\nfunction lastNDaysKeys(n: number): string[] {\r\n  const keys: string[] = [];\r\n  const now = new Date();\r\n  for (let i = n - 1; i >= 0; i--) {\r\n    const d = new Date(now);\r\n    d.setDate(now.getDate() - i);\r\n    keys.push(formatDateKey(d));\r\n  }\r\n  return keys;\r\n}\r\n\r\nasync function loadAnalytics(): Promise<AnalyticsStoreV1 | null> {\r\n  const res = await chrome.storage.local.get(STORAGE_KEYS.ANALYTICS);\r\n  return (res[STORAGE_KEYS.ANALYTICS] as AnalyticsStoreV1 | undefined) ?? null;\r\n}\r\n\r\nfunction downloadJson(filename: string, data: unknown) {\r\n  const blob = new Blob([JSON.stringify(data, null, 2)], { type: \"application/json\" });\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement(\"a\");\r\n  a.href = url;\r\n  a.download = filename;\r\n  a.click();\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\nfunction card(title: string, body: HTMLElement) {\r\n  return el(\"div\", { class: \"card\" }, [el(\"h2\", {}, [text(title)]), body]);\r\n}\r\n\r\nfunction kvRow(label: string, value: string) {\r\n  return el(\"div\", { class: \"kv\" }, [\r\n    el(\"div\", { class: \"k\" }, [text(label)]),\r\n    el(\"div\", { class: \"v\" }, [text(value)]),\r\n  ]);\r\n}\r\n\r\nfunction listTop(obj: Record<string, number>, limit: number) {\r\n  const entries = sortEntries(obj).slice(0, limit);\r\n  if (entries.length === 0) return el(\"div\", { class: \"muted\" }, [text(\"No data yet.\")]);\r\n\r\n  const ul = el(\"ul\", { class: \"list\" });\r\n  for (const [k, v] of entries) {\r\n    ul.appendChild(el(\"li\", {}, [text(`${k}: ${v}`)]));\r\n  }\r\n  return ul;\r\n}\r\n\r\nfunction renderEmpty(root: HTMLElement) {\r\n  root.innerHTML = \"\";\r\n  root.appendChild(\r\n    el(\"div\", { class: \"empty\" }, [\r\n      el(\"h1\", {}, [text(\"Privacy Guard \u2014 Analytics\")]),\r\n      el(\"p\", { class: \"muted\" }, [\r\n        text(\"No analytics yet. Trigger a warning on a supported AI site to generate data.\"),\r\n      ]),\r\n    ])\r\n  );\r\n}\r\n\r\nfunction renderDashboard(root: HTMLElement, store: AnalyticsStoreV1) {\r\n  root.innerHTML = \"\";\r\n\r\n  const header = el(\"div\", { class: \"header\" }, [\r\n    el(\"div\", {}, [\r\n      el(\"h1\", {}, [text(\"Privacy Guard \u2014 Analytics\")]),\r\n      el(\"p\", { class: \"muted\" }, [\r\n        text(\"Counts only. No prompt content is stored or transmitted.\"),\r\n      ]),\r\n    ]),\r\n  ]);\r\n\r\n  const totalsBody = el(\"div\", {}, [\r\n    kvRow(\"Warnings triggered\", String(store.warningsTotal)),\r\n    kvRow(\"Actions: redact\", String(store.byAction.redact ?? 0)),\r\n    kvRow(\"Actions: continue\", String(store.byAction.continue ?? 0)),\r\n    kvRow(\"Actions: cancel\", String(store.byAction.cancel ?? 0)),\r\n  ]);\r\n\r\n  const topHostsBody = listTop(store.byHost ?? {}, UI_LIMITS.MAX_TOP_HOSTS);\r\n  const topCatsBody = listTop(store.byCategory ?? {}, UI_LIMITS.MAX_TOP_CATEGORIES);\r\n\r\n  const trendKeys = lastNDaysKeys(UI_LIMITS.MAX_DAILY_POINTS);\r\n  const trendBody = el(\"div\", {}, [\r\n    el(\"div\", { class: \"muted small\" }, [text(`Last ${trendKeys.length} days`)]),\r\n    el(\"ul\", { class: \"list\" }, trendKeys.map((k) => {\r\n      const v = store.daily?.[k] ?? 0;\r\n      return el(\"li\", {}, [text(`${k}: ${v}`)]);\r\n    })),\r\n  ]);\r\n\r\n  const exportBtn = el(\"button\", { class: \"btn\" }, [text(\"Export anonymized JSON\")]);\r\n  exportBtn.addEventListener(\"click\", () => {\r\n    const ts = new Date();\r\n    const stamp =\r\n      `${ts.getFullYear()}-${String(ts.getMonth() + 1).padStart(2, \"0\")}-${String(ts.getDate()).padStart(2, \"0\")}`;\r\n    downloadJson(`${EXPORT.FILENAME_PREFIX}-${stamp}.json`, store);\r\n  });\r\n\r\n  const exportBody = el(\"div\", {}, [\r\n    el(\"p\", { class: \"muted\" }, [\r\n      text(\"Export includes only aggregated counts (no prompt text).\"),\r\n    ]),\r\n    exportBtn,\r\n  ]);\r\n\r\n  const grid = el(\"div\", { class: \"grid\" }, [\r\n    card(\"Totals\", totalsBody),\r\n    card(\"Top hosts\", topHostsBody),\r\n    card(\"Top categories\", topCatsBody),\r\n    card(\"Trend\", trendBody),\r\n    card(\"Export\", exportBody),\r\n  ]);\r\n\r\n  root.appendChild(header);\r\n  root.appendChild(grid);\r\n}\r\n\r\nexport async function initDashboard() {\r\n  const root = document.getElementById(\"root\");\r\n  if (!root) return;\r\n\r\n  const store = await loadAnalytics();\r\n  if (!store) return renderEmpty(root);\r\n\r\n  renderDashboard(root, store);\r\n\r\n  // Live update when storage changes (nice UX)\r\n  chrome.storage.onChanged.addListener((changes, areaName) => {\r\n    if (areaName !== \"local\") return;\r\n    if (!changes[STORAGE_KEYS.ANALYTICS]) return;\r\n\r\n    const next = changes[STORAGE_KEYS.ANALYTICS].newValue as AnalyticsStoreV1 | undefined;\r\n    if (!next) renderEmpty(root);\r\n    else renderDashboard(root, next);\r\n  });\r\n}\r\n", "import { initDashboard } from \"./ui/dashboard\";\r\n\r\ninitDashboard();"],
  "mappings": "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",
  "names": ["_a", "_b"]
}
